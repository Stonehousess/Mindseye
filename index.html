<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MindsEye</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: black;
      font-family: sans-serif;
    }
    #toolbar {
      position: fixed;
      top: 0;
      width: 100%;
      background: #111;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      z-index: 1000;
    }
    #canvas {
      display: block;
    }
    .panel {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 400px;
      background: #222;
      color: white;
      padding: 20px;
      border-radius: 16px;
      z-index: 999;
      display: none;
    }
    .panel input, .panel textarea {
      width: 100%;
      margin: 5px 0;
      background: #333;
      border: none;
      color: white;
      padding: 5px;
    }
    .panel button {
      margin-right: 10px;
      padding: 6px 12px;
      background: #444;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="toolbar">
    <div><strong>MindsEye</strong></div>
    <div>
      <button onclick="saveIdeas()">Save Ideas</button>
      <input type="file" id="fileLoader" accept=".json" style="display:none" />
      <button onclick="document.getElementById('fileLoader').click()">Load Ideas</button>
    </div>
  </div>
  <canvas id="canvas"></canvas>
  <div class="panel" id="panel">
    <input id="title" placeholder="Title" />
    <textarea id="description" rows="5" placeholder="Description"></textarea>
    <div>
      <button onclick="savePanel()">Save</button>
      <button onclick="changeColor()">Change Color</button>
      <button onclick="closePanel()">Close</button>
    </div>
  </div>
  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const panel = document.getElementById("panel");
    let width, height;
    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    const radius = 80;
    let ideas = [];
    let selectedIdea = null;

    function randomColor() {
      return `hsl(${Math.random()*360}, 100%, 70%)`;
    }

    function addIdea(x, y, title = "New Idea", description = "", color = randomColor()) {
      ideas.push({
        title,
        description,
        x, y,
        vx: Math.random() * 2 - 1,
        vy: Math.random() * 2 - 1,
        color
      });
    }

    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      let clicked = false;
      for (let idea of ideas) {
        const dx = x - idea.x;
        const dy = y - idea.y;
        if (Math.sqrt(dx * dx + dy * dy) < radius) {
          selectedIdea = idea;
          showPanel();
          clicked = true;
          break;
        }
      }
      if (!clicked) {
        addIdea(x, y);
      }
    });

    function showPanel() {
      document.getElementById("title").value = selectedIdea.title;
      document.getElementById("description").value = selectedIdea.description;
      panel.style.display = "block";
    }

    function savePanel() {
      selectedIdea.title = document.getElementById("title").value;
      selectedIdea.description = document.getElementById("description").value;
      panel.style.display = "none";
    }

    function closePanel() {
      panel.style.display = "none";
    }

    function changeColor() {
      selectedIdea.color = randomColor();
    }

    function draw() {
      ctx.clearRect(0, 0, width, height);
      for (let i = 0; i < ideas.length; i++) {
        let a = ideas[i];
        a.x += a.vx;
        a.y += a.vy;

        if (a.x - radius < 0 || a.x + radius > width) a.vx *= -1;
        if (a.y - radius < 50 || a.y + radius > height) a.vy *= -1;

        // Bounce off each other
        for (let j = i + 1; j < ideas.length; j++) {
          let b = ideas[j];
          let dx = a.x - b.x;
          let dy = a.y - b.y;
          let dist = Math.sqrt(dx*dx + dy*dy);
          if (dist < radius * 2) {
            // Simple elastic collision
            let angle = Math.atan2(dy, dx);
            let tx = a.x - Math.cos(angle) * radius * 2;
            let ty = a.y - Math.sin(angle) * radius * 2;
            b.x = tx;
            b.y = ty;
            [a.vx, b.vx] = [b.vx, a.vx];
            [a.vy, b.vy] = [b.vy, a.vy];
          }
        }

        ctx.beginPath();
        ctx.arc(a.x, a.y, radius, 0, Math.PI * 2);
        ctx.fillStyle = a.color;
        ctx.fill();
        ctx.fillStyle = "black";
        ctx.font = "bold 14px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText(a.title, a.x, a.y);
      }
      requestAnimationFrame(draw);
    }
    draw();

    function saveIdeas() {
      const blob = new Blob([JSON.stringify(ideas, null, 2)], {type: "application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "ideas.json";
      a.click();
    }

    document.getElementById("fileLoader").addEventListener("change", function(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          ideas = JSON.parse(event.target.result);
        } catch (err) {
          alert("Invalid JSON file.");
        }
      };
      reader.readAsText(file);
    });

    // Initial ideas
    addIdea(200, 200, "TV Nasty", "My most ambitious concept");
    addIdea(500, 300, "Lucky Days", "Avatar morning show");
    addIdea(300, 500, "Break Point", "Extreme sports transition tale");
    addIdea(600, 200, "Pierette Les Furis", "Stylised femme thriller");
    addIdea(800, 400, "Seare Madre", "Treasure of the Sierra Madre update");
    addIdea(700, 100, "How Not to Have a Sex Change", "Darkly comic documentary");
  </script>
</body>
</html>