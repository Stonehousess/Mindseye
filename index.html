<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MindsEye</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      background-color: black;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    canvas {
      position: fixed;
      top: 0;
      left: 0;
    }
    .panel {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 300px;
      background-color: #222;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 0 20px #fff3;
      display: none;
      z-index: 10;
      color: white;
    }
    .panel input, .panel textarea, .panel button {
      width: 100%;
      margin-top: 10px;
      padding: 8px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
    }
    .panel button {
      background: #333;
      color: white;
      cursor: pointer;
    }
    .toolbar {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 5;
    }
    .toolbar button {
      margin: 5px;
      padding: 10px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <div class="toolbar">
    <button onclick="addBubble()">+ New Idea</button>
    <button onclick="downloadIdeas()">⬇️ Save</button>
    <input type="file" onchange="uploadIdeas(event)" />
  </div>

  <div class="panel" id="editor">
    <input id="bubbleTitle" placeholder="Title" />
    <textarea id="bubbleDesc" rows="5" placeholder="Description"></textarea>
    <input type="color" id="colorPicker" />
    <button onclick="saveBubble()">Save</button>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    let bubbles = [
      { x: 100, y: 100, r: 40, title: 'Pierette Les Furis', desc: 'Idea 1', dx: 2, dy: 1.5, color: '#f00' },
      { x: 300, y: 200, r: 40, title: 'Break Point', desc: 'Idea 2', dx: -2, dy: 2, color: '#0f0' },
      { x: 500, y: 300, r: 40, title: 'Lucky Days', desc: 'Idea 3', dx: 1.5, dy: -2, color: '#00f' },
      { x: 700, y: 250, r: 40, title: 'Seare Madre', desc: 'Idea 4', dx: 2, dy: 1, color: '#ff0' },
      { x: 200, y: 450, r: 40, title: 'TV Nasty', desc: 'Idea 5', dx: -1.5, dy: 2, color: '#0ff' },
      { x: 600, y: 400, r: 40, title: 'How Not to Have a Sex Change', desc: 'Idea 6', dx: 1.2, dy: -1.8, color: '#f0f' }
    ];

    let selected = null;
    const editor = document.getElementById('editor');
    const titleEl = document.getElementById('bubbleTitle');
    const descEl = document.getElementById('bubbleDesc');
    const colorEl = document.getElementById('colorPicker');

    function draw() {
      ctx.clearRect(0, 0, width, height);
      for (let b of bubbles) {
        b.x += b.dx;
        b.y += b.dy;
        if (b.x - b.r < 0 || b.x + b.r > width) b.dx *= -1;
        if (b.y - b.r < 0 || b.y + b.r > height) b.dy *= -1;
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
        ctx.fillStyle = b.color;
        ctx.shadowColor = b.color;
        ctx.shadowBlur = 10;
        ctx.fill();
        ctx.shadowBlur = 0;
      }
      requestAnimationFrame(draw);
    }

    canvas.addEventListener('click', (e) => {
      let rect = canvas.getBoundingClientRect();
      let mx = e.clientX - rect.left;
      let my = e.clientY - rect.top;
      for (let b of bubbles) {
        let dist = Math.hypot(mx - b.x, my - b.y);
        if (dist < b.r) {
          selected = b;
          titleEl.value = b.title;
          descEl.value = b.desc;
          colorEl.value = b.color;
          editor.style.display = 'block';
          return;
        }
      }
    });

    function saveBubble() {
      if (selected) {
        selected.title = titleEl.value;
        selected.desc = descEl.value;
        selected.color = colorEl.value;
        editor.style.display = 'none';
        selected = null;
      }
    }

    function addBubble() {
      bubbles.push({
        x: Math.random() * width,
        y: Math.random() * height,
        r: 40,
        title: 'New Idea',
        desc: '',
        dx: (Math.random() - 0.5) * 4,
        dy: (Math.random() - 0.5) * 4,
        color: '#ccc'
      });
    }

    function downloadIdeas() {
      const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(bubbles));
      const a = document.createElement('a');
      a.setAttribute('href', dataStr);
      a.setAttribute('download', 'mindseye_ideas.json');
      a.click();
    }

    function uploadIdeas(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        bubbles = JSON.parse(e.target.result);
      };
      reader.readAsText(file);
    }

    window.addEventListener('resize', () => {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    });

    draw();
  </script>
</body>
</html>