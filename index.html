<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <title>üí≠MindsEyeüí¨~Ideas</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: black;
      font-family: sans-serif;
    }
    #toolbar {
      position: fixed;
      top: 0;
      width: 100%;
      background: #111;
      opacity: 0.9;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }
    #canvas {
      display: block;
    }
    .panel {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 500px;
      background: rgba(34, 34, 34, 0.92);
      color: white;
      padding: 20px;
      border-radius: 16px;
      z-index: 999;
      display: none;
    }
    .panel input, .panel textarea {
      width: 100%;
      margin: 5px 0;
      background: #333;
      border: none;
      color: white;
      padding: 5px;
    }
    .panel button {
      margin-right: 10px;
      padding: 6px 12px;
      background: #444;
      color: white;
      border: none;
      cursor: pointer;
    }
    #bgVideo {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: -2;
    pointer-events: none;
    display: none; /* default hidden, shown when video is loaded */
}
  </style>
</head>
<body>
  <div id="toolbar">
    <div><strong>üí≠MindsEyeüí¨~Ideas-Incidents-Events-Concerns-LoggerüòéJSON</strong></div>
    <div>
      <button onclick="saveIdeas()">üíæSave.json</button>
      <input type="file" id="fileLoader" accept=".json" style="display:none" />
      <button onclick="document.getElementById('fileLoader').click()">üÜôLoad.json</button>
      <label style="margin-left: 10px;">‚ö°Ô∏èSpeed:
        <input type="range" min="0.0" max="3" step="0.1" value="1" onchange="speedMultiplier = parseFloat(this.value)">
      </label>
      <label style="margin-left: 10px;">Image:
        <input type="file" id="bgLoader" accept="image/*" />
      </label>
      <label style="margin-left: 10px;">Video File:
        <input type="file" id="videoLoader" accept="video/*" />
      </label>
      <label style="margin-left: 10px;">Video Link:
        <input type="text" id="youtubeLink" placeholder="Paste Video URL" style="width:180px;" />
        <button onclick="loadYouTubeVideo()">Load</button>
      </label>
      <button onclick="deleteAllIdeas()" style="margin-left:10px;">Delete All Ideas</button>
    </div>
  </div>

 <video id="bgVideo" autoplay muted loop playsinline style="position:fixed; top:0; left:0; width:100vw; height:100vh; object-fit:cover; z-index:-2; display:none; pointer-events: none;"></video>
  <iframe id="ytFrame" frameborder="0" allow="autoplay" allowfullscreen style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-3; display:none;"></iframe>
  <canvas id="canvas"></canvas>

  <div class="panel" id="panel">
    <input id="title" placeholder="Title" />
    <textarea id="description" rows="5" placeholder="Description"></textarea>
    <label>Size:
      <input type="range" id="sizeSlider" min="10" max="100" value="80" oninput="selectedIdea.radius = parseInt(this.value)">
    </label>
    <div style="margin-top: 10px;">
      <button onclick="savePanel()">Save</button>
      <button onclick="changeColor()">üí≠Ô∏èColor</button>
      <button onclick="changeTextColor()">üí¨Color</button>
      <button onclick="cycleFont()">Font</button>
      <button onclick="deleteIdea()">Delete</button>
      <button onclick="closePanel()">Close</button>
    </div>
  </div>

  <script>
    let movementDelayActive = true;
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const panel = document.getElementById("panel");
    let width, height;
    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    movementDelayActive = true; // Start with movement disabled
    setTimeout(() => {
    movementDelayActive = false; // Enable after 10 seconds
 }, 10000); // 10 seconds

const border = 10;
    
    let speedMultiplier = 1;
    let ideas = [];
    let selectedIdea = null;
    let backgroundImage = null;
    const fonts = ["Tahoma", "Verdana", "Courier New", "Georgia", "Arial"];
    let fontIndex = 0;

    function randomColor() {
      return `hsl(${Math.random() * 360}, 100%, 70%)`;
    }
    function randomTextColor() {
      const colors = ['white', 'black', 'cyan', 'yellow', 'magenta', 'lime', 'red'];
      return colors[Math.floor(Math.random() * colors.length)];
    }
    function addIdea(x, y, title = "New Idea", description = "", color = randomColor(), textColor = "white", radius = 80) {
      const maxSpeed = 3;
      ideas.push({ title, description, x, y, vx: (Math.random() * 2 - 1) * maxSpeed, vy: (Math.random() * 2 - 1) * maxSpeed, color, textColor, radius, font: fonts[0] });
    }

    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      let clicked = false;
      for (let idea of ideas) {
        const dx = x - idea.x;
        const dy = y - idea.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < idea.radius) {
          selectedIdea = idea;
          showPanel();
          clicked = true;
          break;
        }
      }
      if (!clicked) addIdea(x, y);
    });

    function showPanel() {
      document.getElementById("title").value = selectedIdea.title;
      document.getElementById("description").value = selectedIdea.description;
      document.getElementById("sizeSlider").value = selectedIdea.radius || 80;
      panel.style.display = "block";
    }
    function savePanel() {
      selectedIdea.title = document.getElementById("title").value;
      selectedIdea.description = document.getElementById("description").value;
      panel.style.display = "none";
    }
    function deleteIdea() {
      if (selectedIdea) {
        ideas = ideas.filter(idea => idea !== selectedIdea);
        selectedIdea = null;
        panel.style.display = "none";
      }
    }
    function closePanel() { panel.style.display = "none"; }
    function changeColor() { selectedIdea.color = randomColor(); }
    function changeTextColor() { selectedIdea.textColor = randomTextColor(); }
    function cycleFont() {
      fontIndex = (fontIndex + 1) % fonts.length;
      selectedIdea.font = fonts[fontIndex];
    }

    function draw() {
      if (backgroundImage) ctx.drawImage(backgroundImage, 0, 0, width, height);
      else ctx.clearRect(0, 0, width, height);

      for (let i = 0; i < ideas.length; i++) {
        let a = ideas[i];
        const actualSpeed = movementDelayActive ? 0 : speedMultiplier;
        a.x += a.vx * actualSpeed;
        a.y += a.vy * actualSpeed;

        if (a.x - a.radius < border) { a.x = border + a.radius; a.vx *= -1; }
        if (a.x + a.radius > width - border) { a.x = width - border - a.radius; a.vx *= -1; }
        if (a.y - a.radius < border + 50) { a.y = border + 50 + a.radius; a.vy *= -1; }
        if (a.y + a.radius > height - border) { a.y = height - border - a.radius; a.vy *= -1; }

        for (let j = i + 1; j < ideas.length; j++) {
          let b = ideas[j];
          let dx = a.x - b.x;
          let dy = a.y - b.y;
          let dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < a.radius + b.radius) {
            let angle = Math.atan2(dy, dx);
            let tx = a.x - Math.cos(angle) * (a.radius + b.radius);
            let ty = a.y - Math.sin(angle) * (a.radius + b.radius);
            b.x = tx;
            b.y = ty;
            [a.vx, b.vx] = [b.vx, a.vx];
            [a.vy, b.vy] = [b.vy, a.vy];
          }
        }

        const gradient = ctx.createRadialGradient(a.x, a.y, a.radius * 0.6, a.x, a.y, a.radius);
        gradient.addColorStop(0, a.color);
        gradient.addColorStop(1, "black");
        ctx.beginPath();
        ctx.arc(a.x, a.y, a.radius, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.shadowBlur = 10;
        ctx.shadowColor = a.color;
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.fillStyle = a.textColor || "white";
        ctx.font = "bold 14px " + (a.font || "Tahoma");
        ctx.textAlign = "center";
        const words = a.title.split(" ");
        words.forEach((word, idx) => {
          ctx.fillText(word, a.x, a.y + idx * 16 - (words.length - 1) * 8);
        });
      }
      requestAnimationFrame(draw);
    }
    draw();

    function saveIdeas() {
      const dataToSave = ideas.map(idea => ({ ...idea }));
      const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "ideas.json";
      a.click();
    }

    document.getElementById("fileLoader").addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (event) {
    try {
      const loaded = JSON.parse(event.target.result);
      ideas = loaded.map(idea => ({
        ...idea,
        font: idea.font || fonts[0],
        radius: idea.radius || 80
      }));

      // Delay movement after loading
      movementDelayActive = true;
      setTimeout(() => {
        movementDelayActive = false;
      }, 10000);
    } catch (err) {
      alert("Invalid JSON file.");
    }
  };
  reader.readAsText(file);
});

    document.getElementById("bgLoader").addEventListener("change", function (e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function (event) {
        const img = new Image();
        img.onload = function () {
          backgroundImage = img;
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

   document.getElementById("videoLoader").addEventListener("change", function (e) {
  const file = e.target.files[0];
  if (!file) return;

  const video = document.getElementById("bgVideo");
  const iframe = document.getElementById("ytFrame");

  backgroundImage = null;
  iframe.style.display = "none";
  iframe.src = "";

  const objectURL = URL.createObjectURL(file); // ‚¨ÖÔ∏è Better than FileReader for video
  video.src = objectURL;
  video.style.display = "block";

  // Force video to reload and play after src set
  video.src = objectURL;
  video.style.display = "block";

  video.load();

  setTimeout(() => {
  video.play().then(() => {
    console.log("Video playing as background.");
  }).catch((err) => {
    console.warn("Autoplay blocked, trying again on user interaction:", err);
    document.body.addEventListener("click", () => video.play(), { once: true });
  });
}, 100);
});
let isDragging = false;
    let dragOffsetX = 0;
    let dragOffsetY = 0;
    let dragIdea = null;
    let mouseMoved = false;

    canvas.addEventListener("mousedown", (e) => {
      if (speedMultiplier !== 0 || panel.style.display === "block") return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      for (let idea of ideas) {
        const dx = x - idea.x;
        const dy = y - idea.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < idea.radius) {
          isDragging = true;
          dragIdea = idea;
          dragOffsetX = dx;
          dragOffsetY = dy;
          mouseMoved = false;
          return;
        }
      }
    });

    canvas.addEventListener("mousemove", (e) => {
      if (isDragging && dragIdea && speedMultiplier === 0) {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        dragIdea.x = x - dragOffsetX;
        dragIdea.y = y - dragOffsetY;
        mouseMoved = true;
      }
    });

    canvas.addEventListener("mouseup", (e) => {
      if (isDragging && dragIdea && !mouseMoved) {
        selectedIdea = dragIdea;
        showPanel();
      }
      isDragging = false;
      dragIdea = null;
    });
    function loadYouTubeVideo() {
      const url = document.getElementById("youtubeLink").value;
      const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^\s&]+)/);
      const video = document.getElementById("bgVideo");
      const iframe = document.getElementById("ytFrame");
      if (match) {
        const videoId = match[1];
        const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&controls=0&loop=1&playlist=${videoId}`;
        backgroundImage = null;
        video.style.display = "none";
        video.pause();
        iframe.src = embedUrl;
        iframe.style.display = "block";
      } else {
        alert("Invalid YouTube URL.");
      }
    }

    function clearBackground() {
      backgroundImage = null;
      document.getElementById("bgVideo").style.display = "none";
      document.getElementById("bgVideo").pause();
      document.getElementById("ytFrame").style.display = "none";
      document.getElementById("ytFrame").src = "";
    }
    function deleteAllIdeas() {
  if (confirm("CREATE NEW CANVAS? ‚úÖ")) {
    // Clear all ideas
    ideas = [];
    selectedIdea = null;
    panel.style.display = "none";

    // Reset background image
    backgroundImage = null;

    // Reset video
    const video = document.getElementById("bgVideo");
    video.style.display = "none";
    video.pause();
    video.src = "";

    // Reset YouTube iframe
    const iframe = document.getElementById("ytFrame");
    iframe.style.display = "none";
    iframe.src = "";
  }
}

    // Initial Ideas
    ideas = [
  {
    "title": "How Not 2 Have an XChange",
    "description": "Darkly comic documentary",
    "x": 900,
    "y": 450,
    "vx": 0.21,
    "vy": -0.17,
    "color": "hsl(347, 100%, 70%)",
    "textColor": "black",
    "font": "Courier New",
    "radius": 100
  },
  {
    "title": "ü™¶ Tavistock Barrett Scott TP",
    "description": "The most ambitious concept",
    "x": 900,
    "y": 250,
    "vx": -0.12,
    "vy": 0.19,
    "color": "hsl(288, 100%, 70%)",
    "textColor": "red",
    "font": "Georgia",
    "radius": 80
  },
  {
    "title": "GMC",
    "description": "Avatar morning show",
    "x": 1070,
    "y": 300,
    "vx": 0.11,
    "vy": -0.14,
    "color": "hsl(221, 100%, 70%)",
    "textColor": "white",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "PSA",
    "description": "Other Stuff",
    "x": 1120,
    "y": 450,
    "vx": -0.18,
    "vy": 0.16,
    "color": "hsl(93, 100%, 70%)",
    "textColor": "yellow",
    "font": "Verdana",
    "radius": 80
  },
  {
    "title": "üè• UHP Derriford",
    "description": "",
    "x": 1070,
    "y": 600,
    "vx": 0.12,
    "vy": 0.1,
    "color": "hsl(213, 100%, 70%)",
    "textColor": "white",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "üè© OIA/HE ü´†",
    "description": "",
    "x": 900,
    "y": 650,
    "vx": -0.1,
    "vy": -0.13,
    "color": "hsl(185, 100%, 70%)",
    "textColor": "magenta",
    "font": "Arial",
    "radius": 80
  },
  {
    "title": "CQC",
    "description": "",
    "x": 730,
    "y": 600,
    "vx": 0.17,
    "vy": -0.08,
    "color": "hsl(71, 100%, 70%)",
    "textColor": "cyan",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "ICO",
    "description": "A Real Mocumentary",
    "x": 680,
    "y": 450,
    "vx": -0.19,
    "vy": 0.11,
    "color": "hsl(202, 100%, 70%)",
    "textColor": "black",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "NMC ü§ï",
    "description": "Extreme transitional tale",
    "x": 730,
    "y": 300,
    "vx": 0.13,
    "vy": 0.17,
    "color": "hsl(342, 100%, 70%)",
    "textColor": "white",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "HCPC",
    "description": "A Tokyo Love Story",
    "x": 1080,
    "y": 180,
    "vx": -0.11,
    "vy": 0.19,
    "color": "hsl(236, 100%, 70%)",
    "textColor": "white",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "üéìPlymouth University üòí",
    "description": "Matthew Jackson Offer",
    "x": 500,
    "y": 650,
    "vx": 0.14,
    "vy": -0.09,
    "color": "hsl(121, 100%, 70%)",
    "textColor": "white",
    "font": "Georgia",
    "radius": 58
  },
  {
    "title": "Devon ICB",
    "description": "Martyn\nMegan Barrett",
    "x": 650,
    "y": 180,
    "vx": 0.16,
    "vy": 0.13,
    "color": "hsl(127, 100%, 70%)",
    "textColor": "white",
    "font": "Arial",
    "radius": 80
  },
  {
    "title": "Fam üòå",
    "description": "",
    "x": 400,
    "y": 200,
    "vx": -0.1,
    "vy": 0.18,
    "color": "hsl(310, 100%, 70%)",
    "textColor": "white",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "Live West üíä",
    "description": "",
    "x": 400,
    "y": 800,
    "vx": 0.13,
    "vy": -0.1,
    "color": "hsl(351, 100%, 70%)",
    "textColor": "yellow",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "Laurels",
    "description": "Sound Meadre",
    "x": 1400,
    "y": 800,
    "vx": -0.17,
    "vy": -0.12,
    "color": "hsl(44, 100%, 70%)",
    "textColor": "cyan",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "DC's Finest üö®",
    "description": "",
    "x": 1500,
    "y": 100,
    "vx": -0.16,
    "vy": 0.15,
    "color": "hsl(163, 100%, 70%)",
    "textColor": "black",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "Pierette Les Furis",
    "description": "Stylised femme thriller",
    "x": 300,
    "y": 400,
    "vx": 0.1,
    "vy": -0.2,
    "color": "hsl(59, 100%, 70%)",
    "textColor": "white",
    "font": "Tahoma",
    "radius": 80
  },
  {
    "title": "ü´• SRA üòÇ",
    "description": "",
    "x": 650,
    "y": 800,
    "vx": 0.12,
    "vy": 0.16,
    "color": "hsl(355, 100%, 70%)",
    "textColor": "white",
    "font": "Tahoma",
    "radius": 80
  }
];
let toolbar = document.getElementById('toolbar');
let inactivityTimeout;

function showToolbar() {
  toolbar.style.opacity = "1";
  clearTimeout(inactivityTimeout);
  inactivityTimeout = setTimeout(() => {
    toolbar.style.opacity = "0";
  }, 5000); // 5 seconds
}

// Show on any mouse movement
document.addEventListener("mousemove", showToolbar);

// Initially call it so toolbar hides after 5s
showToolbar();
  </script>
</body>
</html>
